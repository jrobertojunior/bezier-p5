<html>
  <head> </head>
  <body>
    <!-- <h1>Curva Bezier</h1> -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/p5.js"></script>
    <script>
      points = [];
      resolution = 100; // n points for each curve

      function calculateBezier(points) {
        result = [];
        start = points[0];
        for (let t = 0; t <= 1; t += 1 / resolution) {
          controls = points;

          while (controls.length > 1) {
            aux = [];

            for (i = 0; i < controls.length - 1; i++) {
              aux[i] = interpolate(t, controls[i], controls[i + 1]);
            }
            controls = aux;
          }

          result.push(controls[0]);
        }
        return result;
      }
      function mouseClicked() {
        if (!canAddPoint) {
          canAddPoint = true;
          return;
        }
        points.push({ x: mouseX, y: mouseY });
        print(points);
      }

      function interpolate(t, p0, p1) {
        return { x: (1 - t) * p0.x + t * p1.x, y: (1 - t) * p0.y + t * p1.y };
      }

      let clearButton;
      canAddPoint = true;

      function setup() {
        createCanvas(400, 400);
        strokeWeight(4);
        points = [
          { x: 63, y: 200 },
          { x: 174, y: 118 },
          { x: 215, y: 236 },
          { x: 331, y: 160 },
        ];
        clearButton = createButton("clear");
        clearButton.position(14, 380);
        clearButton.mousePressed(() => {
          points = [];
          canAddPoint = false;
        });
      }

      function draw() {
        clear();
        background(50);
        if (points.length < 1) return;

        // set curve color
        stroke(237, 34, 93);
        strokeWeight(4);

        thecurve = calculateBezier(points);

        // draw bezier curve
        for (i = 0; i < thecurve.length - 1; i++) {
          line(
            thecurve[i].x,
            thecurve[i].y,
            thecurve[i + 1].x,
            thecurve[i + 1].y
          );
        }

        // draw lines
        for (i = 0; i < points.length - 1; i++) {
          stroke(237, 34, 93, 50);
          strokeWeight(3);

          line(points[i].x, points[i].y, points[i + 1].x, points[i + 1].y);
        }

        stroke(255, 255, 255, 100);
        strokeWeight(6);
        // draw points
        for (i = 0; i < points.length; i++) {
          point(points[i].x, points[i].y);
        }
      }
    </script>
  </body>
</html>
