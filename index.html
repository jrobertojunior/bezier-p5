<html>
  <head> </head>
  <style>
    body {
      /* font-family: monospace; */
    }
  </style>
  <body>
    <!-- <h1>Curva Bezier</h1> -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/p5.js"></script>
    <script>
      window.addEventListener("contextmenu", (e) => e.preventDefault());

      let data;
      let currentIndex = 1;
      let resolution = 100;

      function initData() {
        data = [
          {
            color: [250, 50, 100], // redish
            points: [
              { x: 100, y: 250 },
              { x: 200, y: 100 },
              { x: 300, y: 350 },
              { x: 400, y: 200 },
            ],
            curve: [],
          },
          {
            color: [43, 117, 61], // greenish
            points: [],
            curve: [],
          },
        ];
      }
      function interpolate(t, p0, p1) {
        return { x: (1 - t) * p0.x + t * p1.x, y: (1 - t) * p0.y + t * p1.y };
      }
      function calculateBezier(points, resolution) {
        if (points === undefined || points.length < 1) return [];
        result = [];
        start = points[0];
        for (let t = 0; t <= 1; t += 1 / resolution) {
          controls = points;

          while (controls.length > 1) {
            aux = [];

            for (i = 0; i < controls.length - 1; i++) {
              aux[i] = interpolate(t, controls[i], controls[i + 1]);
            }
            controls = aux;
          }

          result.push(controls[0]);
        }
        return result;
      }

      function mousePressed() {
        print(mouseX, mouseY);
        // if mouse cursor is close to x 20 y 20
        if (dist(mouseX, mouseY, 20, 20) <= 15) {
          currentIndex = (currentIndex + 1) % data.length;
          return;
        }
        
        data[currentIndex].points.push({
          x: mouseX,
          y: mouseY,
        });
      }

      function setup() {
        createCanvas(500, 500);
        initData();
      }

      function draw() {
        clear();
        background(50);

        // draw point representing current index
        strokeWeight(15);
        stroke(...data[currentIndex].color);
        point(20, 20);

        // calculate bezier
        for (let i = 0; i < data.length; i++) {
          data[i].curve = calculateBezier(data[i].points, resolution);
        }

        for (let i = 0; i < data.length; i++) {
          // draw points and lines
          for (let p = 0; p < data[i].points.length; p++) {
            // make line brighter and translucid
            strokeWeight(5);
            stroke(
              data[i].color[0] + 50,
              data[i].color[1] + 50,
              data[i].color[2] + 50,
              50
            );
            if (p < data[i].points.length - 1) {
              line(
                data[i].points[p].x,
                data[i].points[p].y,
                data[i].points[p + 1].x,
                data[i].points[p + 1].y
              );
            }
            strokeWeight(9);
            stroke(data[i].color[0], data[i].color[1], data[i].color[2]);
            point(data[i].points[p].x, data[i].points[p].y);
          }

          // draw curve
          stroke(...data[i].color);
          strokeWeight(5);
          if (data[i].curve.length > 0) {
            for (let p = 0; p < data[i].curve.length - 1; p++) {
              line(
                data[i].curve[p].x,
                data[i].curve[p].y,
                data[i].curve[p + 1].x,
                data[i].curve[p + 1].y
              );
            }
          }
        }
      }
    </script>
  </body>
</html>
